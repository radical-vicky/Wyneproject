{% extends "base.html" %}

{% block title %}Create Post - CoopConnect{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">
                <i class="fas fa-plus-circle me-2"></i>Create New Post
            </h4>
        </div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data" id="postForm">
                {% csrf_token %}
                
                <!-- Post Type -->
                <div class="mb-4">
                    <label class="form-label mb-3">Post Type</label>
                    <div class="post-type-buttons d-flex gap-2">
                        <button type="button" class="btn btn-secondary flex-1 post-type-btn active" data-type="text">
                            <i class="fas fa-font me-2"></i>Text
                        </button>
                        <button type="button" class="btn btn-secondary flex-1 post-type-btn" data-type="image">
                            <i class="fas fa-image me-2"></i>Image
                        </button>
                        <button type="button" class="btn btn-secondary flex-1 post-type-btn" data-type="video">
                            <i class="fas fa-video me-2"></i>Video
                        </button>
                    </div>
                    <input type="hidden" name="post_type" id="id_post_type" value="text">
                </div>
                
                <!-- Content -->
                <div class="form-group mb-4">
                    <label for="id_content" class="form-label">What's on your mind?</label>
                    <textarea name="content" id="id_content" rows="4" 
                              class="form-control" 
                              placeholder="Share your thoughts, experiences, or updates..." 
                              required></textarea>
                </div>
                
                <!-- Image Upload -->
                <div id="imageSection" class="mb-4 d-none">
                    <label class="form-label">Upload Image</label>
                    <div class="border-dashed rounded-lg p-4 text-center mb-3">
                        <i class="fas fa-image fa-3x text-secondary mb-3"></i>
                        <p class="text-secondary">Select an image file</p>
                        <label for="id_image" class="btn btn-primary">
                            <i class="fas fa-folder-open me-2"></i>Choose Image
                        </label>
                        <input type="file" name="image" id="id_image" class="d-none" accept="image/*">
                    </div>
                    <div id="imagePreview" class="text-center d-none">
                        <img src="#" alt="Preview" class="img-fluid rounded-lg mb-2" style="max-height: 200px;">
                        <button type="button" class="btn btn-sm btn-secondary" onclick="clearImage()">
                            <i class="fas fa-times me-1"></i>Remove Image
                        </button>
                    </div>
                </div>
                
                <!-- Video Upload -->
                <div id="videoSection" class="mb-4 d-none">
                    <label class="form-label">Upload Video</label>
                    <div class="border-dashed rounded-lg p-4 text-center mb-3">
                        <i class="fas fa-video fa-3x text-secondary mb-3"></i>
                        <p class="text-secondary">Select a video file (MP4, max 100MB)</p>
                        <label for="id_video" class="btn btn-primary">
                            <i class="fas fa-folder-open me-2"></i>Choose Video
                        </label>
                        <input type="file" name="video" id="id_video" class="d-none" accept="video/*">
                    </div>
                    <div id="videoPreview" class="text-center d-none">
                        <video controls class="img-fluid rounded-lg mb-2" style="max-height: 200px;"></video>
                        <button type="button" class="btn btn-sm btn-secondary" onclick="clearVideo()">
                            <i class="fas fa-times me-1"></i>Remove Video
                        </button>
                    </div>
                </div>
                
                <!-- Location -->
                <div class="form-group mb-4">
                    <label for="id_location" class="form-label">
                        <i class="fas fa-map-marker-alt me-2"></i>Location (Optional)
                    </label>
                    <input type="text" name="location" id="id_location" 
                           class="form-control" 
                           placeholder="Add your location...">
                </div>
                
                <!-- Visibility -->
                <div class="mb-4">
                    <label class="form-label">Post Visibility</label>
                    <div class="visibility-buttons d-flex gap-2">
                        <button type="button" class="btn btn-secondary flex-1 visibility-btn active" data-visibility="public">
                            <i class="fas fa-globe me-2"></i>Public
                        </button>
                        <button type="button" class="btn btn-secondary flex-1 visibility-btn" data-visibility="contacts">
                            <i class="fas fa-users me-2"></i>Contacts
                        </button>
                        <button type="button" class="btn btn-secondary flex-1 visibility-btn" data-visibility="private">
                            <i class="fas fa-lock me-2"></i>Private
                        </button>
                    </div>
                    <input type="hidden" name="visibility" id="id_visibility" value="public">
                </div>
                
                <!-- Actions -->
                <div class="d-flex justify-content-between">
                    <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                        <i class="fas fa-times me-2"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-paper-plane me-2"></i>Post Now
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.post-type-btn, .visibility-btn {
    padding: 12px;
    border: 2px solid rgba(255,255,255,0.1);
    transition: all 0.3s ease;
}

.post-type-btn.active, .visibility-btn.active {
    border-color: var(--coop-green);
    background: rgba(0, 168, 89, 0.1);
    color: var(--coop-green);
}

.flex-1 {
    flex: 1;
}
</style>

<script>
$(document).ready(function() {
    // Post type selection
    $('.post-type-btn').click(function() {
        $('.post-type-btn').removeClass('active');
        $(this).addClass('active');
        
        const type = $(this).data('type');
        $('#id_post_type').val(type);
        
        // Show/hide sections
        $('#imageSection, #videoSection').addClass('d-none');
        if (type === 'image') {
            $('#imageSection').removeClass('d-none');
        } else if (type === 'video') {
            $('#videoSection').removeClass('d-none');
        }
    });
    
    // Visibility selection
    $('.visibility-btn').click(function() {
        $('.visibility-btn').removeClass('active');
        $(this).addClass('active');
        $('#id_visibility').val($(this).data('visibility'));
    });
    
    // Image preview
    $('#id_image').change(function() {
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                $('#imagePreview img').attr('src', e.target.result);
                $('#imagePreview').removeClass('d-none');
                $('.post-type-btn[data-type="image"]').click();
            }
            reader.readAsDataURL(this.files[0]);
        }
    });
    
    // Video preview
    $('#id_video').change(function() {
        if (this.files && this.files[0]) {
            const video = $('#videoPreview video')[0];
            const url = URL.createObjectURL(this.files[0]);
            video.src = url;
            $('#videoPreview').removeClass('d-none');
            $('.post-type-btn[data-type="video"]').click();
        }
    });
    
    // Clear functions
    window.clearImage = function() {
        $('#id_image').val('');
        $('#imagePreview').addClass('d-none');
        $('.post-type-btn[data-type="text"]').click();
    }
    
    window.clearVideo = function() {
        $('#id_video').val('');
        $('#videoPreview').addClass('d-none');
        $('.post-type-btn[data-type="text"]').click();
    }
    
    // Form submission
    $('#postForm').submit(function() {
        $('#submitBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin"></i> Posting...');
    });
});
</script>
{% endblock %}