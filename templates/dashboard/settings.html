{% extends 'base.html' %}

{% block title %}Settings - CoopConnect Premium{% endblock %}

{% block extra_css %}
<style>
.settings-container {
    max-width: 800px;
    margin: 0 auto;
}

.settings-tabs {
    display: flex;
    background: var(--darker-bg);
    border-radius: var(--radius);
    padding: 5px;
    margin-bottom: 30px;
    overflow-x: auto;
}

.settings-tab {
    flex: 1;
    min-width: 120px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    border-radius: var(--radius);
    transition: all 0.3s ease;
    font-weight: 500;
}

.settings-tab:hover {
    background: rgba(255,255,255,0.05);
}

.settings-tab.active {
    background: var(--coop-green);
    color: white;
}

.settings-section {
    background: var(--card-bg);
    border-radius: var(--radius-lg);
    padding: 30px;
    margin-bottom: 25px;
    border: 1px solid var(--border-color);
}

.section-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
}

.section-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(0,168,89,0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--coop-green);
    font-size: 1.2rem;
}

.section-title {
    font-size: 1.3rem;
    font-weight: 600;
}

.section-subtitle {
    color: var(--text-secondary);
    font-size: 0.95rem;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 0;
    border-bottom: 1px solid var(--border-color);
}

.setting-item:last-child {
    border-bottom: none;
}

.setting-info {
    flex: 1;
}

.setting-title {
    font-weight: 500;
    margin-bottom: 5px;
}

.setting-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.setting-control {
    margin-left: 20px;
}

.theme-selector {
    display: flex;
    gap: 15px;
}

.theme-option {
    width: 100px;
    height: 80px;
    border-radius: var(--radius);
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.theme-option:hover {
    transform: translateY(-2px);
}

.theme-option.active {
    border-color: var(--coop-green);
}

.theme-preview {
    height: 60px;
    display: flex;
    flex-direction: column;
}

.theme-name {
    text-align: center;
    padding: 5px;
    font-size: 0.8rem;
}

.theme-light .theme-preview {
    background: #ffffff;
}

.theme-light .theme-preview::before {
    content: '';
    flex: 1;
    background: #f5f5f5;
    margin: 5px;
    border-radius: 3px;
}

.theme-dark .theme-preview {
    background: #1a1a2e;
}

.theme-dark .theme-preview::before {
    content: '';
    flex: 1;
    background: #11111f;
    margin: 5px;
    border-radius: 3px;
}

.language-selector {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

.language-option {
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
}

.language-option:hover {
    border-color: var(--coop-green);
    background: rgba(0,168,89,0.05);
}

.language-option.active {
    border-color: var(--coop-green);
    background: rgba(0,168,89,0.1);
}

.language-flag {
    font-size: 1.5rem;
    margin-bottom: 10px;
}

.security-log {
    background: rgba(255,255,255,0.02);
    border-radius: var(--radius);
    padding: 15px;
    margin-top: 10px;
}

.log-entry {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid var(--border-color);
}

.log-entry:last-child {
    border-bottom: none;
}

.log-details {
    flex: 1;
}

.log-action {
    font-weight: 500;
    margin-bottom: 5px;
}

.log-info {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.log-time {
    color: var(--text-muted);
    font-size: 0.8rem;
}

.delete-account {
    background: rgba(244,67,54,0.1);
    border: 1px solid rgba(244,67,54,0.3);
    border-radius: var(--radius);
    padding: 25px;
    margin-top: 30px;
}

.delete-warning {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    margin-bottom: 20px;
}

.delete-warning i {
    color: var(--danger);
    font-size: 1.5rem;
}

.data-export {
    background: rgba(33,150,243,0.1);
    border: 1px solid rgba(33,150,243,0.3);
    border-radius: var(--radius);
    padding: 25px;
    margin-top: 20px;
}

.export-options {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.export-option {
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius);
    cursor: pointer;
    transition: all 0.3s ease;
}

.export-option:hover {
    border-color: var(--info);
    background: rgba(33,150,243,0.05);
}

@media (max-width: 768px) {
    .settings-tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
    }
    
    .settings-tab {
        min-width: 100px;
        padding: 10px;
        font-size: 0.9rem;
    }
    
    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .setting-control {
        margin-left: 0;
        width: 100%;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">Settings</h1>
            <p class="card-subtitle">Manage your account preferences and privacy</p>
        </div>
        
        <div class="card-body">
            <!-- Settings Tabs -->
            <div class="settings-tabs">
                <div class="settings-tab active" data-tab="account">Account</div>
                <div class="settings-tab" data-tab="privacy">Privacy</div>
                <div class="settings-tab" data-tab="notifications">Notifications</div>
                <div class="settings-tab" data-tab="security">Security</div>
                <div class="settings-tab" data-tab="appearance">Appearance</div>
                <div class="settings-tab" data-tab="billing">Billing</div>
            </div>
            
            <!-- Account Settings -->
            <div class="settings-section" id="accountTab">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <div>
                        <h2 class="section-title">Account Settings</h2>
                        <p class="section-subtitle">Manage your account information and preferences</p>
                    </div>
                </div>
                
                <form method="POST" id="accountForm">
                    {% csrf_token %}
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Email Address</div>
                            <div class="setting-description">Your primary email for notifications and account recovery</div>
                        </div>
                        <div class="setting-control">
                            <input type="email" class="form-control" value="{{ user.email }}" disabled>
                            <a href="{% url 'account_email' %}" class="btn btn-sm btn-secondary mt-2">
                                <i class="fas fa-edit"></i> Manage Emails
                            </a>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Phone Number</div>
                            <div class="setting-description">Used for M-Pesa transactions and verification</div>
                        </div>
                        <div class="setting-control">
                            <input type="tel" class="form-control" value="{{ user.profile.phone_number }}" disabled>
                            <a href="{% url 'profile_edit' %}" class="btn btn-sm btn-secondary mt-2">
                                <i class="fas fa-edit"></i> Change in Profile
                            </a>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Username</div>
                            <div class="setting-description">Your unique identifier on CoopConnect</div>
                        </div>
                        <div class="setting-control">
                            <input type="text" class="form-control" value="{{ user.username }}" disabled>
                            <small class="text-secondary">Cannot be changed</small>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Account Type</div>
                            <div class="setting-description">Your current account level and privileges</div>
                        </div>
                        <div class="setting-control">
                            <span class="badge {% if user.profile.is_vip %}badge-vip{% else %}badge-secondary{% endif %}">
                                {% if user.profile.is_vip %}VIP Member{% else %}Standard Member{% endif %}
                            </span>
                            {% if not user.profile.is_vip %}
                            <a href="#" class="btn btn-sm btn-primary mt-2 d-block">
                                <i class="fas fa-crown"></i> Upgrade to VIP
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Account Created</div>
                            <div class="setting-description">Date you joined CoopConnect</div>
                        </div>
                        <div class="setting-control">
                            <span class="text-secondary">{{ user.date_joined|date:"F d, Y" }}</span>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-end gap-3 mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Privacy Settings -->
            <div class="settings-section d-none" id="privacyTab">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div>
                        <h2 class="section-title">Privacy Settings</h2>
                        <p class="section-subtitle">Control who can see your information and contact you</p>
                    </div>
                </div>
                
                <form method="POST" id="privacyForm">
                    {% csrf_token %}
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Profile Visibility</div>
                            <div class="setting-description">Who can view your profile</div>
                        </div>
                        <div class="setting-control">
                            <select class="form-control" name="profile_visibility">
                                <option value="public" {% if user.settings.profile_visibility == 'public' %}selected{% endif %}>
                                    Public (Everyone)
                                </option>
                                <option value="contacts" {% if user.settings.profile_visibility == 'contacts' %}selected{% endif %}>
                                    Contacts Only
                                </option>
                                <option value="private" {% if user.settings.profile_visibility == 'private' %}selected{% endif %}>
                                    Private (Only Me)
                                </option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Online Status</div>
                            <div class="setting-description">Show when you're online</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="show_online_status" 
                                       {% if user.settings.show_online_status %}checked{% endif %}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Allow Calls</div>
                            <div class="setting-description">Allow other users to call you</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="allow_calls" 
                                       {% if user.settings.allow_calls %}checked{% endif %}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Show Last Active</div>
                            <div class="setting-description">Show when you were last active</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="show_last_active" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Profile in Search Results</div>
                            <div class="setting-description">Include your profile in search results</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="show_in_search" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Read Receipts</div>
                            <div class="setting-description">Show when you've read messages</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="read_receipts" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-end gap-3 mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Privacy Settings
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Notification Settings -->
            <div class="settings-section d-none" id="notificationsTab">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div>
                        <h2 class="section-title">Notification Settings</h2>
                        <p class="section-subtitle">Choose how you want to be notified</p>
                    </div>
                </div>
                
                <form method="POST" id="notificationsForm">
                    {% csrf_token %}
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Email Notifications</div>
                            <div class="setting-description">Receive notifications via email</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="email_notifications" 
                                       {% if user.settings.email_notifications %}checked{% endif %}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Push Notifications</div>
                            <div class="setting-description">Receive browser notifications</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="push_notifications" 
                                       {% if user.settings.push_notifications %}checked{% endif %}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">SMS Notifications</div>
                            <div class="setting-description">Receive notifications via SMS</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="sms_notifications" 
                                       {% if user.settings.sms_notifications %}checked{% endif %}>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h4 class="mb-3">Notification Types</h4>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">New Messages</div>
                                <div class="setting-description">When you receive new messages</div>
                            </div>
                            <div class="setting-control">
                                <label class="switch">
                                    <input type="checkbox" name="notify_messages" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">Booking Requests</div>
                                <div class="setting-description">When you receive booking requests</div>
                            </div>
                            <div class="setting-control">
                                <label class="switch">
                                    <input type="checkbox" name="notify_bookings" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">Payment Updates</div>
                                <div class="setting-description">When payments are completed</div>
                            </div>
                            <div class="setting-control">
                                <label class="switch">
                                    <input type="checkbox" name="notify_payments" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">Profile Views</div>
                                <div class="setting-description">When someone views your profile</div>
                            </div>
                            <div class="setting-control">
                                <label class="switch">
                                    <input type="checkbox" name="notify_views" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-title">New Contacts</div>
                                <div class="setting-description">When someone adds you as contact</div>
                            </div>
                            <div class="setting-control">
                                <label class="switch">
                                    <input type="checkbox" name="notify_contacts" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-end gap-3 mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Notification Settings
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Security Settings -->
            <div class="settings-section d-none" id="securityTab">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div>
                        <h2 class="section-title">Security Settings</h2>
                        <p class="section-subtitle">Manage your account security and access</p>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Change Password</div>
                        <div class="setting-description">Update your account password</div>
                    </div>
                    <div class="setting-control">
                        <a href="{% url 'account_change_password' %}" class="btn btn-primary">
                            <i class="fas fa-key"></i> Change Password
                        </a>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Two-Factor Authentication</div>
                        <div class="setting-description">Add an extra layer of security to your account</div>
                    </div>
                    <div class="setting-control">
                        <label class="switch">
                            <input type="checkbox" name="two_factor" disabled>
                            <span class="slider"></span>
                        </label>
                        <small class="text-secondary d-block mt-2">Coming soon</small>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Login Sessions</div>
                        <div class="setting-description">Manage your active login sessions</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-secondary" onclick="viewLoginSessions()">
                            <i class="fas fa-desktop"></i> View Sessions
                        </button>
                    </div>
                </div>
                
                <div class="security-log">
                    <h4 class="mb-3">Recent Security Activity</h4>
                    <div class="log-entry">
                        <div class="log-details">
                            <div class="log-action">Password Changed</div>
                            <div class="log-info">Password was updated successfully</div>
                        </div>
                        <div class="log-time">2 days ago</div>
                    </div>
                    <div class="log-entry">
                        <div class="log-details">
                            <div class="log-action">New Login</div>
                            <div class="log-info">Login from Chrome on Windows</div>
                        </div>
                        <div class="log-time">1 week ago</div>
                    </div>
                    <div class="log-entry">
                        <div class="log-details">
                            <div class="log-action">Profile Updated</div>
                            <div class="log-info">Profile information was modified</div>
                        </div>
                        <div class="log-time">2 weeks ago</div>
                    </div>
                </div>
                
                <div class="delete-account">
                    <div class="delete-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <h4>Danger Zone</h4>
                            <p class="text-secondary">
                                Once you delete your account, there is no going back. 
                                Please be certain.
                            </p>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteAccount()">
                        <i class="fas fa-trash"></i> Delete Account
                    </button>
                </div>
            </div>
            
            <!-- Appearance Settings -->
            <div class="settings-section d-none" id="appearanceTab">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div>
                        <h2 class="section-title">Appearance Settings</h2>
                        <p class="section-subtitle">Customize how CoopConnect looks</p>
                    </div>
                </div>
                
                <form method="POST" id="appearanceForm">
                    {% csrf_token %}
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Theme</div>
                            <div class="setting-description">Choose your preferred theme</div>
                        </div>
                        <div class="setting-control">
                            <div class="theme-selector">
                                <div class="theme-option theme-dark active" onclick="selectTheme('dark')">
                                    <div class="theme-preview"></div>
                                    <div class="theme-name">Dark</div>
                                </div>
                                <div class="theme-option theme-light" onclick="selectTheme('light')">
                                    <div class="theme-preview"></div>
                                    <div class="theme-name">Light</div>
                                </div>
                            </div>
                            <input type="hidden" name="theme" value="{{ user.settings.theme|default:'dark' }}">
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Language</div>
                            <div class="setting-description">Choose your preferred language</div>
                        </div>
                        <div class="setting-control">
                            <div class="language-selector">
                                <div class="language-option active" onclick="selectLanguage('en')">
                                    <div class="language-flag">ðŸ‡ºðŸ‡¸</div>
                                    <div>English</div>
                                </div>
                                <div class="language-option" onclick="selectLanguage('sw')">
                                    <div class="language-flag">ðŸ‡¹ðŸ‡¿</div>
                                    <div>Swahili</div>
                                </div>
                                <div class="language-option" onclick="selectLanguage('fr')">
                                    <div class="language-flag">ðŸ‡«ðŸ‡·</div>
                                    <div>French</div>
                                </div>
                            </div>
                            <input type="hidden" name="language" value="{{ user.settings.language|default:'en' }}">
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Font Size</div>
                            <div class="setting-description">Adjust the text size</div>
                        </div>
                        <div class="setting-control">
                            <select class="form-control" name="font_size">
                                <option value="small">Small</option>
                                <option value="medium" selected>Medium</option>
                                <option value="large">Large</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Animation Effects</div>
                            <div class="setting-description">Enable or disable animations</div>
                        </div>
                        <div class="setting-control">
                            <label class="switch">
                                <input type="checkbox" name="animations" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-end gap-3 mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Appearance Settings
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetAppearance()">
                            <i class="fas fa-undo"></i> Reset to Default
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Billing Settings -->
            <div class="settings-section d-none" id="billingTab">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <div>
                        <h2 class="section-title">Billing Settings</h2>
                        <p class="section-subtitle">Manage your billing information and subscriptions</p>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Billing Address</div>
                        <div class="setting-description">Your primary billing address</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-secondary" onclick="updateBillingAddress()">
                            <i class="fas fa-edit"></i> Update Address
                        </button>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Tax Information</div>
                        <div class="setting-description">Your tax identification details</div>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-secondary" onclick="updateTaxInfo()">
                            <i class="fas fa-file-invoice"></i> Update Tax Info
                        </button>
                    </div>
                </div>
                
                <div class="data-export">
                    <h4 class="mb-3">Data & Reports</h4>
                    <p class="text-secondary mb-3">Download your account data and transaction history</p>
                    
                    <div class="export-options">
                        <div class="export-option" onclick="exportData('transactions')">
                            <i class="fas fa-exchange-alt fa-2x mb-2"></i>
                            <div>Transaction History</div>
                            <div class="text-secondary text-sm">CSV, PDF, Excel</div>
                        </div>
                        
                        <div class="export-option" onclick="exportData('bookings')">
                            <i class="fas fa-calendar-check fa-2x mb-2"></i>
                            <div>Booking History</div>
                            <div class="text-secondary text-sm">CSV, PDF</div>
                        </div>
                        
                        <div class="export-option" onclick="exportData('profile')">
                            <i class="fas fa-user fa-2x mb-2"></i>
                            <div>Profile Data</div>
                            <div class="text-secondary text-sm">JSON, PDF</div>
                        </div>
                        
                        <div class="export-option" onclick="exportData('messages')">
                            <i class="fas fa-comments fa-2x mb-2"></i>
                            <div>Message History</div>
                            <div class="text-secondary text-sm">JSON, PDF</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Tab switching
    $('.settings-tab').click(function() {
        const tabId = $(this).data('tab');
        
        // Update active tab
        $('.settings-tab').removeClass('active');
        $(this).addClass('active');
        
        // Show selected tab content
        $('.settings-section').addClass('d-none');
        $(`#${tabId}Tab`).removeClass('d-none');
    });
    
    // Initialize current tab
    const currentTab = window.location.hash.substring(1) || 'account';
    $(`.settings-tab[data-tab="${currentTab}"]`).click();
    
    // Update URL hash when switching tabs
    $('.settings-tab').click(function() {
        window.location.hash = $(this).data('tab');
    });
    
    // Initialize theme selection
    const currentTheme = '{{ user.settings.theme|default:"dark" }}';
    selectTheme(currentTheme);
    
    // Initialize language selection
    const currentLanguage = '{{ user.settings.language|default:"en" }}';
    selectLanguage(currentLanguage);
});

function selectTheme(theme) {
    $('.theme-option').removeClass('active');
    $(`.theme-option.theme-${theme}`).addClass('active');
    $('input[name="theme"]').val(theme);
    
    // Preview theme change
    if (theme === 'light') {
        $('body').addClass('theme-light').removeClass('theme-dark');
    } else {
        $('body').addClass('theme-dark').removeClass('theme-light');
    }
}

function selectLanguage(language) {
    $('.language-option').removeClass('active');
    $(`.language-option[onclick*="${language}"]`).addClass('active');
    $('input[name="language"]').val(language);
}

function resetAppearance() {
    selectTheme('dark');
    selectLanguage('en');
    $('select[name="font_size"]').val('medium');
    $('input[name="animations"]').prop('checked', true);
    
    // Reset body classes
    $('body').addClass('theme-dark').removeClass('theme-light');
}

function viewLoginSessions() {
    showModal(`
        <div class="p-4">
            <h3 class="card-title mb-3">Active Login Sessions</h3>
            
            <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle"></i>
                These are devices where you're currently logged in
            </div>
            
            <div class="session-list">
                <div class="session-item d-flex align-center justify-between p-3 mb-2 rounded" 
                     style="background: rgba(255,255,255,0.05);">
                    <div>
                        <div class="font-bold">Current Session</div>
                        <div class="text-secondary text-sm">Chrome on Windows â€¢ Just now</div>
                        <div class="text-secondary text-sm">IP: 192.168.1.1 â€¢ Location: Nairobi, Kenya</div>
                    </div>
                    <span class="badge badge-success">Active</span>
                </div>
                
                <div class="session-item d-flex align-center justify-between p-3 mb-2 rounded" 
                     style="background: rgba(255,255,255,0.05);">
                    <div>
                        <div class="font-bold">Mobile Device</div>
                        <div class="text-secondary text-sm">Safari on iPhone â€¢ 2 days ago</div>
                        <div class="text-secondary text-sm">IP: 192.168.1.2 â€¢ Location: Nairobi, Kenya</div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="endSession(this)">
                        <i class="fas fa-sign-out-alt"></i> End
                    </button>
                </div>
            </div>
            
            <div class="d-flex gap-3 mt-4">
                <button class="btn btn-danger" onclick="endAllSessions()">
                    <i class="fas fa-sign-out-alt"></i> End All Other Sessions
                </button>
                <button class="btn btn-secondary" onclick="hideModal()">
                    Close
                </button>
            </div>
        </div>
    `);
}

function endSession(button) {
    $(button).closest('.session-item').remove();
    showAlert('Session ended successfully', 'success');
}

function endAllSessions() {
    $('.session-item:not(:first)').remove();
    showAlert('All other sessions ended', 'success');
}

function deleteAccount() {
    showModal(`
        <div class="text-center p-4">
            <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
            <h3>Delete Account</h3>
            <p class="text-secondary">This action cannot be undone. All your data will be permanently deleted.</p>
            
            <div class="form-group mt-4">
                <label class="form-label">Type "DELETE" to confirm</label>
                <input type="text" class="form-control" id="deleteConfirm" 
                       placeholder="Type DELETE here">
            </div>
            
            <div class="d-flex gap-3 justify-center mt-4">
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Delete My Account
                </button>
                <button class="btn btn-secondary" onclick="hideModal()">
                    Cancel
                </button>
            </div>
        </div>
    `);
}

function confirmDelete() {
    const confirmation = $('#deleteConfirm').val();
    
    if (confirmation !== 'DELETE') {
        alert('Please type "DELETE" to confirm');
        return;
    }
    
    // Show final warning
    showModal(`
        <div class="text-center p-4">
            <i class="fas fa-exclamation-circle fa-3x text-warning mb-3"></i>
            <h3>Final Warning</h3>
            <p class="text-secondary">Are you absolutely sure? This will:</p>
            <ul class="text-left text-secondary mt-3">
                <li>Permanently delete your profile</li>
                <li>Remove all your photos and videos</li>
                <li>Delete all your messages</li>
                <li>Cancel all pending bookings</li>
                <li>Forfeit any remaining wallet balance</li>
            </ul>
            
            <div class="d-flex gap-3 justify-center mt-4">
                <button class="btn btn-danger" onclick="proceedDelete()">
                    <i class="fas fa-trash"></i> Yes, Delete Everything
                </button>
                <button class="btn btn-secondary" onclick="hideModal()">
                    No, Keep My Account
                </button>
            </div>
        </div>
    `);
}

function proceedDelete() {
    // In production, this would make an API call
    showModal(`
        <div class="text-center p-4">
            <div class="spinner mb-3"></div>
            <h3>Deleting Account</h3>
            <p class="text-secondary">Please wait while we delete your account...</p>
        </div>
    `);
    
    setTimeout(() => {
        hideModal();
        // Redirect to home page
        window.location.href = '{% url "landing" %}';
    }, 2000);
}

function updateBillingAddress() {
    showModal(`
        <div class="p-4">
            <h3 class="card-title mb-3">Update Billing Address</h3>
            
            <div class="form-group">
                <label class="form-label">Street Address</label>
                <input type="text" class="form-control" placeholder="123 Main Street">
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">City</label>
                        <input type="text" class="form-control" placeholder="Nairobi">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Postal Code</label>
                        <input type="text" class="form-control" placeholder="00100">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Country</label>
                <select class="form-control">
                    <option>Kenya</option>
                    <option>Tanzania</option>
                    <option>Uganda</option>
                    <option>Rwanda</option>
                </select>
            </div>
            
            <div class="d-flex gap-3 mt-4">
                <button class="btn btn-primary" onclick="saveBillingAddress()">
                    <i class="fas fa-save"></i> Save Address
                </button>
                <button class="btn btn-secondary" onclick="hideModal()">
                    Cancel
                </button>
            </div>
        </div>
    `);
}

function saveBillingAddress() {
    hideModal();
    showAlert('Billing address updated successfully', 'success');
}

function updateTaxInfo() {
    showModal(`
        <div class="p-4">
            <h3 class="card-title mb-3">Update Tax Information</h3>
            
            <div class="alert alert-info mb-4">
                <i class="fas fa-info-circle"></i>
                Tax information is required for payment processing and reporting
            </div>
            
            <div class="form-group">
                <label class="form-label">Tax Identification Number</label>
                <input type="text" class="form-control" placeholder="Enter TIN">
            </div>
            
            <div class="form-group">
                <label class="form-label">Tax Country</label>
                <select class="form-control">
                    <option>Kenya</option>
                    <option>Tanzania</option>
                    <option>Uganda</option>
                    <option>Rwanda</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Tax Certificate (Optional)</label>
                <input type="file" class="form-control">
                <small class="text-secondary">Upload your tax certificate (PDF, JPG, PNG)</small>
            </div>
            
            <div class="d-flex gap-3 mt-4">
                <button class="btn btn-primary" onclick="saveTaxInfo()">
                    <i class="fas fa-save"></i> Save Tax Info
                </button>
                <button class="btn btn-secondary" onclick="hideModal()">
                    Cancel
                </button>
            </div>
        </div>
    `);
}

function saveTaxInfo() {
    hideModal();
    showAlert('Tax information updated successfully', 'success');
}

function exportData(type) {
    const formats = {
        'transactions': ['CSV', 'PDF', 'Excel'],
        'bookings': ['CSV', 'PDF'],
        'profile': ['JSON', 'PDF'],
        'messages': ['JSON', 'PDF']
    };
    
    showModal(`
        <div class="p-4">
            <h3 class="card-title mb-3">Export ${type.charAt(0).toUpperCase() + type.slice(1)} Data</h3>
            
            <div class="form-group">
                <label class="form-label">Select Format</label>
                <div class="export-format-options">
                    ${formats[type].map(format => `
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="exportFormat" 
                                   id="format${format}" value="${format.toLowerCase()}">
                            <label class="form-check-label" for="format${format}">
                                ${format} Format
                            </label>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Date Range (Optional)</label>
                <div class="row">
                    <div class="col-md-6">
                        <input type="date" class="form-control" placeholder="From">
                    </div>
                    <div class="col-md-6">
                        <input type="date" class="form-control" placeholder="To">
                    </div>
                </div>
            </div>
            
            <div class="alert alert-info mt-3">
                <i class="fas fa-info-circle"></i>
                Large exports may take several minutes to prepare.
            </div>
            
            <div class="d-flex gap-3 mt-4">
                <button class="btn btn-primary" onclick="generateExport('${type}')">
                    <i class="fas fa-download"></i> Generate Export
                </button>
                <button class="btn btn-secondary" onclick="hideModal()">
                    Cancel
                </button>
            </div>
        </div>
    `);
}

function generateExport(type) {
    showModal(`
        <div class="text-center p-4">
            <div class="spinner mb-3"></div>
            <h3>Generating Export</h3>
            <p class="text-secondary">Preparing your data for download...</p>
        </div>
    `);
    
    setTimeout(() => {
        hideModal();
        showModal(`
            <div class="text-center p-4">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h3>Export Ready!</h3>
                <p class="text-secondary">Your ${type} data has been prepared for download.</p>
                <a href="#" class="btn btn-primary mt-3" onclick="hideModal()">
                    <i class="fas fa-download"></i> Download File
                </a>
                <button class="btn btn-secondary mt-3" onclick="hideModal()">
                    Close
                </button>
            </div>
        `);
    }, 2000);
}

function showAlert(message, type) {
    const alert = $(`
        <div class="alert alert-${type}" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
    `);
    
    $('body').append(alert);
    
    setTimeout(() => {
        alert.fadeOut(300, () => alert.remove());
    }, 3000);
}
</script>
{% endblock %}